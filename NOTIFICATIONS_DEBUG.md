# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–ï—Å–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç, —Å–ª–µ–¥—É–π—Ç–µ —ç—Ç–æ–º—É —á–µ–∫-–ª–∏—Å—Ç—É:

## 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
docker compose ps
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã –∏ healthy:
- `todo_project-backend-1` (healthy)
- `todo_project-worker-1` (Up)
- `todo_project-beat-1` (Up)
- `todo_project-bot-1` (Up)
- `todo_project-db-1` (healthy)
- `todo_project-redis-1` (healthy)

–ï—Å–ª–∏ –∫–∞–∫–æ–π-—Ç–æ —Å–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—â–µ–Ω:
```bash
docker compose up -d
```

## 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Celery

```bash
docker compose logs beat worker --tail 100 --follow
```

### –ß—Ç–æ –∏—Å–∫–∞—Ç—å:

#### Beat (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫):
```
Scheduler: Sending due task send-due-task-notifications-every-minute
```

#### Worker (–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å):
```
Task todo.tasks.send_due_task_notifications[...] received
Task todo.tasks.send_due_task_notifications[...] succeeded in ...s: 0
```

–ï—Å–ª–∏ –∑–∞–¥–∞—á–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö worker.

## 3. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–¥–∞—á—É —Å –¥–µ–¥–ª–∞–π–Ω–æ–º

### –ß–µ—Ä–µ–∑ –±–æ—Ç–∞:
1. –ù–∞–ø–∏—à–∏—Ç–µ `/start`
2. –ù–∞–∂–º–∏—Ç–µ ¬´–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É¬ª
3. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: `–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞`
4. –í–≤–µ–¥–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é: `–¢–µ—Å—Ç`
5. –í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É: —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `12.02.2026`)
6. –í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è: –≤—Ä–µ–º—è –Ω–∞ 2 –º–∏–Ω—É—Ç—ã –≤–ø–µ—Ä–µ–¥ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ

### –ß–µ—Ä–µ–∑ API:
```bash
curl -X POST http://localhost:8000/api/tasks/ \
  -H "Content-Type: application/json" \
  -d '{
    "title": "–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞",
    "category_id": 1,
    "telegram_id": "–í–ê–®_TELEGRAM_ID",
    "due_date": "2026-02-12T14:30:00"
  }'
```

## 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–¥–∞—á—É –≤ –∞–¥–º–∏–Ω–∫–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:8000/admin`
2. –°–æ–∑–¥–∞–π—Ç–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
   ```bash
   docker compose exec backend uv run python manage.py createsuperuser
   ```
3. –ù–∞–π–¥–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—É—é –∑–∞–¥–∞—á—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—è:
   - `due_date` ‚Äî –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–∞—Ç–∞ –≤ –ø—Ä–æ—à–ª–æ–º/–Ω–∞—Å—Ç–æ—è—â–µ–º
   - `is_notified` ‚Äî –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `False`

## 5. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–ª–µ–¥—É—é—â–µ–π –º–∏–Ω—É—Ç—ã

Celery Beat –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (cron: `minute="*"`).

–ß–µ—Ä–µ–∑ 1-2 –º–∏–Ω—É—Ç—ã:

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ worker:
```bash
docker compose logs worker --tail 20
```

–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ | task_id=... user=tg_123456 title=–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ due_date=...
```

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram:
–í –±–æ—Ç–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–æ –∑–∞–¥–∞—á–µ
–ù–∞–∑–≤–∞–Ω–∏–µ: –¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞
–ö–∞—Ç–µ–≥–æ—Ä–∏—è: –¢–µ—Å—Ç
–î–µ–¥–ª–∞–π–Ω: 12.02.2026 14:30
```

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–µ –≤ –∞–¥–º–∏–Ω–∫–µ:
- `is_notified` –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –Ω–∞ `True`
- `notification_sent_at` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ

## 6. –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç, –Ω–æ –≤ –ª–æ–≥–∞—Ö `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ`

**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–∏—Å–∞–ª –±–æ—Ç—É `/start`, –∏–ª–∏ —É –Ω–µ–≥–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±–æ—Ç.

**–†–µ—à–µ–Ω–∏–µ**: 
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
2. –ù–∞–∂–º–∏—Ç–µ `/start`
3. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É —Å –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ–π

### –í –ª–æ–≥–∞—Ö –æ—à–∏–±–∫–∞ `TELEGRAM_BOT_TOKEN –Ω–µ –∑–∞–¥–∞–Ω`

**–ü—Ä–∏—á–∏–Ω–∞**: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä worker/beat.

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `TELEGRAM_BOT_TOKEN=...` –∑–∞–ø–æ–ª–Ω–µ–Ω
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
   ```bash
   docker compose down
   docker compose up -d
   ```

### –í –ª–æ–≥–∞—Ö –æ—à–∏–±–∫–∞ `Cannot connect to host backend:8000`

**–ü—Ä–∏—á–∏–Ω–∞**: Worker/beat —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª–∏ —Ä–∞–Ω—å—à–µ, —á–µ–º backend —Å—Ç–∞–ª healthy.

**–†–µ—à–µ–Ω–∏–µ**: –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –æ–Ω–∞ —Ä–µ—à–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ healthcheck. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç:
```bash
docker compose restart worker beat
```

### –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ `is_notified` –æ—Å—Ç–∞–µ—Ç—Å—è `False`

**–ü—Ä–∏—á–∏–Ω–∞**: 
- –õ–∏–±–æ `due_date` –≤ –±—É–¥—É—â–µ–º
- –õ–∏–±–æ –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram –Ω–µ —É–¥–∞–ª–∞—Å—å (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ worker –Ω–∞ –æ—à–∏–±–∫–∏)

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `due_date` ‚Äî –æ–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å <= —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ worker –Ω–∞ –æ—à–∏–±–∫–∏ HTTP –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Telegram

## 7. –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

–í—ã –º–æ–∂–µ—Ç–µ –≤—Ä—É—á–Ω—É—é –≤—ã–∑–≤–∞—Ç—å Celery-–∑–∞–¥–∞—á—É:

```bash
docker compose exec backend uv run python manage.py shell
```

–í shell:
```python
from todo.tasks import send_due_task_notifications
result = send_due_task_notifications()
print(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: {result}")
```

–≠—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ –≤—Å–µ–º –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–º –∑–∞–¥–∞—á–∞–º —Å `is_notified=False`.
